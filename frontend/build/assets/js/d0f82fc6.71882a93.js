"use strict";(globalThis.webpackChunkphysical_ai_platform_frontend=globalThis.webpackChunkphysical_ai_platform_frontend||[]).push([[6582],{4812:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module-2/week-1-introduction/2-4-simulation-practical-exercises","title":"2.4: Simulation Practical Exercises","description":"Overview","source":"@site/docs/module-2/week-1-introduction/2-4-simulation-practical-exercises.md","sourceDirName":"module-2/week-1-introduction","slug":"/module-2/week-1-introduction/2-4-simulation-practical-exercises","permalink":"/docs/module-2/week-1-introduction/2-4-simulation-practical-exercises","draft":false,"unlisted":false,"editUrl":"https://github.com/noor-ana/physical-ai-platform/tree/main/docs/module-2/week-1-introduction/2-4-simulation-practical-exercises.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"difficulty":"intermediate"},"sidebar":"tutorialSidebar","previous":{"title":"2.3: Basic Simulation Concepts and World Building","permalink":"/docs/module-2/week-1-introduction/2-3-basic-simulation-concepts"},"next":{"title":"Week 2: Gazebo Basics","permalink":"/docs/module-2/week-2-gazebo-basics/2-1-introduction-to-gazebo"}}');var t=n(4848),s=n(8453);const o={sidebar_position:4,difficulty:"intermediate"},a="2.4: Simulation Practical Exercises",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Exercise 1: Complete Simulation Environment Setup",id:"exercise-1-complete-simulation-environment-setup",level:2},{value:"Objective",id:"objective",level:3},{value:"Step 1: Create Package Structure",id:"step-1-create-package-structure",level:3},{value:"Step 2: Create World Files",id:"step-2-create-world-files",level:3},{value:"Step 3: Create Robot Model",id:"step-3-create-robot-model",level:3},{value:"Step 4: Create Controller Configuration",id:"step-4-create-controller-configuration",level:3},{value:"Exercise 2: Robot Control in Simulation",id:"exercise-2-robot-control-in-simulation",level:2},{value:"Objective",id:"objective-1",level:3},{value:"Exercise 3: Sensor Integration and Processing",id:"exercise-3-sensor-integration-and-processing",level:2},{value:"Objective",id:"objective-2",level:3},{value:"Exercise 4: Launch File Integration",id:"exercise-4-launch-file-integration",level:2},{value:"Objective",id:"objective-3",level:3},{value:"Exercise 5: Custom Gazebo Plugin",id:"exercise-5-custom-gazebo-plugin",level:2},{value:"Objective",id:"objective-4",level:3},{value:"Exercise 6: Testing and Validation",id:"exercise-6-testing-and-validation",level:2},{value:"Objective",id:"objective-5",level:3},{value:"Exercise 7: Package Configuration Files",id:"exercise-7-package-configuration-files",level:2},{value:"Update Package Files",id:"update-package-files",level:3},{value:"Exercise 8: Running the Complete Simulation",id:"exercise-8-running-the-complete-simulation",level:2},{value:"Steps to Execute:",id:"steps-to-execute",level:3},{value:"Troubleshooting Common Issues",id:"troubleshooting-common-issues",level:2},{value:"1. Robot not moving in simulation",id:"1-robot-not-moving-in-simulation",level:3},{value:"2. Sensor data not available",id:"2-sensor-data-not-available",level:3},{value:"3. TF tree issues",id:"3-tf-tree-issues",level:3},{value:"Performance Optimization Tips",id:"performance-optimization-tips",level:2},{value:"1. Physics Optimization",id:"1-physics-optimization",level:3},{value:"2. Sensor Rate Optimization",id:"2-sensor-rate-optimization",level:3},{value:"Summary",id:"summary",level:2}];function d(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"24-simulation-practical-exercises",children:"2.4: Simulation Practical Exercises"})}),"\n",(0,t.jsx)(r.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(r.p,{children:"This submodule provides hands-on exercises to apply the simulation concepts learned in the previous submodules. You'll create a complete simulation environment, implement robot control, work with sensors in simulation, and integrate everything with ROS 2."}),"\n",(0,t.jsx)(r.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,t.jsx)(r.p,{children:"By the end of this submodule, you will:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Build a complete simulation environment from scratch"}),"\n",(0,t.jsx)(r.li,{children:"Implement robot navigation in simulation"}),"\n",(0,t.jsx)(r.li,{children:"Work with simulated sensor data"}),"\n",(0,t.jsx)(r.li,{children:"Create custom Gazebo plugins"}),"\n",(0,t.jsx)(r.li,{children:"Integrate simulation with ROS 2 control systems"}),"\n",(0,t.jsx)(r.li,{children:"Debug common simulation issues"}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"exercise-1-complete-simulation-environment-setup",children:"Exercise 1: Complete Simulation Environment Setup"}),"\n",(0,t.jsx)(r.h3,{id:"objective",children:"Objective"}),"\n",(0,t.jsx)(r.p,{children:"Create a complete simulation environment with a robot, world, and necessary ROS 2 integration."}),"\n",(0,t.jsx)(r.h3,{id:"step-1-create-package-structure",children:"Step 1: Create Package Structure"}),"\n",(0,t.jsx)(r.p,{children:"First, let's create the necessary directories for our simulation package:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"cd ~/ros2_ws/src\r\nros2 pkg create --build-type ament_python simulation_exercises\r\ncd simulation_exercises\n"})}),"\n",(0,t.jsx)(r.h3,{id:"step-2-create-world-files",children:"Step 2: Create World Files"}),"\n",(0,t.jsxs)(r.p,{children:["Create a directory for our worlds and create a basic world file ",(0,t.jsx)(r.code,{children:"simulation_exercises/worlds/robotics_lab.sdf"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-xml",children:'<?xml version="1.0" ?>\r\n<sdf version="1.7">\r\n  <world name="robotics_lab">\r\n    \x3c!-- Include standard models --\x3e\r\n    <include>\r\n      <uri>model://ground_plane</uri>\r\n    </include>\r\n    \r\n    <include>\r\n      <uri>model://sun</uri>\r\n    </include>\r\n    \r\n    \x3c!-- Physics configuration --\x3e\r\n    <physics name="ode" default="0" type="ode">\r\n      <gravity>0 0 -9.8</gravity>\r\n      <ode>\r\n        <solver>\r\n          <type>quick</type>\r\n          <iters>100</iters>\r\n          <sor>1.3</sor>\r\n        </solver>\r\n        <constraints>\r\n          <cfm>0.0</cfm>\r\n          <erp>0.2</erp>\r\n          <contact_max_correcting_vel>100.0</contact_max_correcting_vel>\r\n          <contact_surface_layer>0.001</contact_surface_layer>\r\n        </constraints>\r\n      </ode>\r\n      <max_step_size>0.001</max_step_size>\r\n      <real_time_factor>1</real_time_factor>\r\n      <real_time_update_rate>1000</real_time_update_rate>\r\n    </physics>\r\n    \r\n    \x3c!-- Add a basic lab environment with obstacles --\x3e\r\n    \x3c!-- Walls --\x3e\r\n    <model name="wall_1">\r\n      <static>true</static>\r\n      <pose>0 5 1 0 0 0</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <box>\r\n              <size>10 0.2 2</size>\r\n            </box>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <box>\r\n              <size>10 0.2 2</size>\r\n            </box>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.6 0.6 0.6 1</ambient>\r\n            <diffuse>0.6 0.6 0.6 1</diffuse>\r\n          </material>\r\n        </visual>\r\n      </link>\r\n    </model>\r\n    \r\n    <model name="wall_2">\r\n      <static>true</static>\r\n      <pose>0 -5 1 0 0 0</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <box>\r\n              <size>10 0.2 2</size>\r\n            </box>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <box>\r\n              <size>10 0.2 2</size>\r\n            </box>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.6 0.6 0.6 1</ambient>\r\n            <diffuse>0.6 0.6 0.6 1</diffuse>\r\n          </material>\r\n        </visual>\r\n      </link>\r\n    </model>\r\n    \r\n    <model name="wall_3">\r\n      <static>true</static>\r\n      <pose>5 0 1 0 0 1.57</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <box>\r\n              <size>10 0.2 2</size>\r\n            </box>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <box>\r\n              <size>10 0.2 2</size>\r\n            </box>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.6 0.6 0.6 1</ambient>\r\n            <diffuse>0.6 0.6 0.6 1</diffuse>\r\n          </material>\r\n        </visual>\r\n      </link>\r\n    </model>\r\n    \r\n    <model name="wall_4">\r\n      <static>true</static>\r\n      <pose>-5 0 1 0 0 1.57</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <box>\r\n              <size>10 0.2 2</size>\r\n            </box>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <box>\r\n              <size>10 0.2 2</size>\r\n            </box>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.6 0.6 0.6 1</ambient>\r\n            <diffuse>0.6 0.6 0.6 1</diffuse>\r\n          </material>\r\n        </visual>\r\n      </link>\r\n    </model>\r\n    \r\n    \x3c!-- Add obstacles --\x3e\r\n    <model name="obstacle_1">\r\n      <static>false</static>\r\n      <pose>2 2 0.2 0 0 0</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <box>\r\n              <size>0.4 0.4 0.4</size>\r\n            </box>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <box>\r\n              <size>0.4 0.4 0.4</size>\r\n            </box>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.8 0.2 0.2 1</ambient>\r\n            <diffuse>0.8 0.2 0.2 1</diffuse>\r\n          </material>\r\n        </visual>\r\n        <inertial>\r\n          <mass>1</mass>\r\n          <inertia>\r\n            <ixx>0.0133</ixx>\r\n            <ixy>0</ixy>\r\n            <ixz>0</ixz>\r\n            <iyy>0.0133</iyy>\r\n            <iyz>0</iyz>\r\n            <izz>0.0133</izz>\r\n          </inertia>\r\n        </inertial>\r\n      </link>\r\n    </model>\r\n    \r\n    <model name="obstacle_2">\r\n      <static>false</static>\r\n      <pose>-2 -2 0.5 0 0 0</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <cylinder>\r\n              <radius>0.2</radius>\r\n              <length>1.0</length>\r\n            </cylinder>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <cylinder>\r\n              <radius>0.2</radius>\r\n              <length>1.0</length>\r\n            </cylinder>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.2 0.8 0.2 1</ambient>\r\n            <diffuse>0.2 0.8 0.2 1</diffuse>\r\n          </material>\r\n        </visual>\r\n        <inertial>\r\n          <mass>2</mass>\r\n          <inertia>\r\n            <ixx>0.15</ixx>\r\n            <ixy>0</ixy>\r\n            <ixz>0</ixz>\r\n            <iyy>0.15</iyy>\r\n            <iyz>0</iyz>\r\n            <izz>0.1</izz>\r\n          </inertia>\r\n        </inertial>\r\n      </link>\r\n    </model>\r\n    \r\n    \x3c!-- Add a charging station (special area) --\x3e\r\n    <model name="charging_station">\r\n      <static>true</static>\r\n      <pose>4 -4 0.05 0 0 0</pose>\r\n      <link name="link">\r\n        <collision name="collision">\r\n          <geometry>\r\n            <box>\r\n              <size>1.0 1.0 0.1</size>\r\n            </box>\r\n          </geometry>\r\n        </collision>\r\n        <visual name="visual">\r\n          <geometry>\r\n            <box>\r\n              <size>1.0 1.0 0.1</size>\r\n            </box>\r\n          </geometry>\r\n          <material>\r\n            <ambient>0.8 0.8 0.2 1</ambient>\r\n            <diffuse>0.8 0.8 0.2 1</diffuse>\r\n          </material>\r\n        </visual>\r\n      </link>\r\n    </model>\r\n  </world>\r\n</sdf>\n'})}),"\n",(0,t.jsx)(r.h3,{id:"step-3-create-robot-model",children:"Step 3: Create Robot Model"}),"\n",(0,t.jsxs)(r.p,{children:["Create the robot URDF file ",(0,t.jsx)(r.code,{children:"simulation_exercises/urdf/differential_drive_robot.urdf"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-xml",children:'<?xml version="1.0"?>\r\n<robot name="diff_drive_robot" xmlns:xacro="http://www.ros.org/wiki/xacro">\r\n  \r\n  \x3c!-- Properties --\x3e\r\n  <xacro:property name="M_PI" value="3.1415926535897931"/>\r\n  <xacro:property name="base_width" value="0.3"/>\r\n  <xacro:property name="base_length" value="0.4"/>\r\n  <xacro:property name="base_height" value="0.15"/>\r\n  <xacro:property name="wheel_radius" value="0.05"/>\r\n  <xacro:property name="wheel_width" value="0.025"/>\r\n  <xacro:property name="wheel_mass" value="0.2"/>\r\n  <xacro:property name="base_mass" value="5.0"/>\r\n  \r\n  \x3c!-- Base link --\x3e\r\n  <link name="base_link">\r\n    <visual>\r\n      <origin xyz="0 0 0" rpy="0 0 0"/>\r\n      <geometry>\r\n        <box size="${base_length} ${base_width} ${base_height}"/>\r\n      </geometry>\r\n      <material name="blue">\r\n        <color rgba="0.0 0.0 0.8 1.0"/>\r\n      </material>\r\n    </visual>\r\n    \r\n    <collision>\r\n      <origin xyz="0 0 0" rpy="0 0 0"/>\r\n      <geometry>\r\n        <box size="${base_length} ${base_width} ${base_height}"/>\r\n      </geometry>\r\n    </collision>\r\n    \r\n    <inertial>\r\n      <mass value="${base_mass}"/>\r\n      <origin xyz="0 0 0" rpy="0 0 0"/>\r\n      <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.2"/>\r\n    </inertial>\r\n  </link>\r\n  \r\n  \x3c!-- Base footprint --\x3e\r\n  <link name="base_footprint">\r\n    <visual>\r\n      <geometry>\r\n        <cylinder radius="0.01" length="0.001"/>\r\n      </geometry>\r\n      <material name="white">\r\n        <color rgba="1.0 1.0 1.0 1.0"/>\r\n      </material>\r\n    </visual>\r\n    \r\n    <collision>\r\n      <origin xyz="0 0 0.05" rpy="0 0 0"/>\r\n      <geometry>\r\n        <cylinder radius="${base_width/2}" length="0.1"/>\r\n      </geometry>\r\n    </collision>\r\n    \r\n    <inertial>\r\n      <mass value="0.0001"/>\r\n      <inertia ixx="0.0001" ixy="0.0" ixz="0.0" iyy="0.0001" iyz="0.0" izz="0.0001"/>\r\n    </inertial>\r\n  </link>\r\n  \r\n  \x3c!-- Joint: base_footprint to base_link --\x3e\r\n  <joint name="base_footprint_joint" type="fixed">\r\n    <parent link="base_footprint"/>\r\n    <child link="base_link"/>\r\n    <origin xyz="0 0 ${base_height/2}" rpy="0 0 0"/>\r\n  </joint>\r\n  \r\n  \x3c!-- Macro for wheels --\x3e\r\n  <xacro:macro name="wheel" params="prefix reflect">\r\n    <link name="${prefix}_wheel_link">\r\n      <visual>\r\n        <origin xyz="0 0 0" rpy="${M_PI/2} 0 0"/>\r\n        <geometry>\r\n          <cylinder radius="${wheel_radius}" length="${wheel_width}"/>\r\n        </geometry>\r\n        <material name="black">\r\n          <color rgba="0.0 0.0 0.0 1.0"/>\r\n        </material>\r\n      </visual>\r\n      \r\n      <collision>\r\n        <origin xyz="0 0 0" rpy="${M_PI/2} 0 0"/>\r\n        <geometry>\r\n          <cylinder radius="${wheel_radius}" length="${wheel_width}"/>\r\n        </geometry>\r\n      </collision>\r\n      \r\n      <inertial>\r\n        <mass value="${wheel_mass}"/>\r\n        <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.002"/>\r\n      </inertial>\r\n    </link>\r\n    \r\n    <joint name="${prefix}_wheel_joint" type="continuous">\r\n      <parent link="base_link"/>\r\n      <child link="${prefix}_wheel_link"/>\r\n      <origin xyz="${base_length/2 - wheel_width/2} ${reflect * base_width/2} -${base_height/2}" rpy="0 0 0"/>\r\n      <axis xyz="0 1 0"/>\r\n    </joint>\r\n  </xacro:macro>\r\n  \r\n  \x3c!-- Create wheels --\x3e\r\n  <xacro:wheel prefix="left" reflect="1"/>\r\n  <xacro:wheel prefix="right" reflect="-1"/>\r\n  \r\n  \x3c!-- Camera link --\x3e\r\n  <link name="camera_link">\r\n    <visual>\r\n      <geometry>\r\n        <box size="0.05 0.1 0.03"/>\r\n      </geometry>\r\n      <material name="red">\r\n        <color rgba="0.8 0.0 0.0 1.0"/>\r\n      </material>\r\n    </visual>\r\n    \r\n    <collision>\r\n      <geometry>\r\n        <box size="0.05 0.1 0.03"/>\r\n      </geometry>\r\n    </collision>\r\n    \r\n    <inertial>\r\n      <mass value="0.05"/>\r\n      <inertia ixx="0.0001" ixy="0.0" ixz="0.0" iyy="0.0001" iyz="0.0" izz="0.0001"/>\r\n    </inertial>\r\n  </link>\r\n  \r\n  <joint name="camera_joint" type="fixed">\r\n    <parent link="base_link"/>\r\n    <child link="camera_link"/>\r\n    <origin xyz="${base_length/2 - 0.025} 0 ${base_height/2}" rpy="0 0 0"/>\r\n  </joint>\r\n  \r\n  \x3c!-- IMU link --\x3e\r\n  <link name="imu_link">\r\n    <inertial>\r\n      <mass value="0.01"/>\r\n      <inertia ixx="0.0001" ixy="0.0" ixz="0.0" iyy="0.0001" iyz="0.0" izz="0.0001"/>\r\n    </inertial>\r\n  </link>\r\n  \r\n  <joint name="imu_joint" type="fixed">\r\n    <parent link="base_link"/>\r\n    <child link="imu_link"/>\r\n    <origin xyz="0 0 ${base_height/4}" rpy="0 0 0"/>\r\n  </joint>\r\n  \r\n  \x3c!-- Gazebo plugins --\x3e\r\n  <gazebo reference="base_link">\r\n    <material>Gazebo/Blue</material>\r\n  </gazebo>\r\n  \r\n  <gazebo reference="left_wheel_link">\r\n    <material>Gazebo/Black</material>\r\n    <mu1>1.0</mu1>\r\n    <mu2>1.0</mu2>\r\n  </gazebo>\r\n  \r\n  <gazebo reference="right_wheel_link">\r\n    <material>Gazebo/Black</material>\r\n    <mu1>1.0</mu1>\r\n    <mu2>1.0</mu2>\r\n  </gazebo>\r\n  \r\n  <gazebo reference="camera_link">\r\n    <material>Gazebo/Red</material>\r\n  </gazebo>\r\n\r\n  \x3c!-- Differential drive controller plugin --\x3e\r\n  <gazebo>\r\n    <plugin name="diff_drive" filename="libgazebo_ros_diff_drive.so">\r\n      <update_rate>30</update_rate>\r\n      <left_joint>left_wheel_joint</left_joint>\r\n      <right_joint>right_wheel_joint</right_joint>\r\n      <wheel_separation>${base_width}</wheel_separation>\r\n      <wheel_diameter>${2 * wheel_radius}</wheel_diameter>\r\n      <max_wheel_torque>20</max_wheel_torque>\r\n      <max_wheel_acceleration>1.0</max_wheel_acceleration>\r\n      <command_topic>cmd_vel</command_topic>\r\n      <odometry_topic>odom</odometry_topic>\r\n      <odometry_frame>odom</odometry_frame>\r\n      <robot_base_frame>base_footprint</robot_base_frame>\r\n      <publish_odom>true</publish_odom>\r\n      <publish_odom_tf>true</publish_odom_tf>\r\n      <publish_wheel_tf>false</publish_wheel_tf>\r\n    </plugin>\r\n  </gazebo>\r\n\r\n  \x3c!-- Camera plugin --\x3e\r\n  <gazebo reference="camera_link">\r\n    <sensor name="camera" type="camera">\r\n      <update_rate>30</update_rate>\r\n      <camera name="head">\r\n        <horizontal_fov>1.047</horizontal_fov>\r\n        <image>\r\n          <width>640</width>\r\n          <height>480</height>\r\n          <format>R8G8B8</format>\r\n        </image>\r\n        <clip>\r\n          <near>0.1</near>\r\n          <far>10</far>\r\n        </clip>\r\n      </camera>\r\n      <plugin name="camera_controller" filename="libgazebo_ros_camera.so">\r\n        <frame_name>camera_link</frame_name>\r\n        <min_depth>0.1</min_depth>\r\n        <max_depth>10</max_depth>\r\n      </plugin>\r\n    </sensor>\r\n  </gazebo>\r\n\r\n  \x3c!-- IMU plugin --\x3e\r\n  <gazebo reference="imu_link">\r\n    <sensor name="imu_sensor" type="imu">\r\n      <always_on>true</always_on>\r\n      <update_rate>50</update_rate>\r\n      <plugin name="imu_plugin" filename="libgazebo_ros_imu.so">\r\n        <frame_name>imu_link</frame_name>\r\n        <topic>imu/data</topic>\r\n        <serviceName>imu_service</serviceName>\r\n      </plugin>\r\n    </sensor>\r\n  </gazebo>\r\n</robot>\n'})}),"\n",(0,t.jsx)(r.h3,{id:"step-4-create-controller-configuration",children:"Step 4: Create Controller Configuration"}),"\n",(0,t.jsxs)(r.p,{children:["Create controller configuration file ",(0,t.jsx)(r.code,{children:"simulation_exercises/config/diff_drive_controller.yaml"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",children:'controller_manager:\r\n  ros__parameters:\r\n    update_rate: 100  # Hz\r\n    use_sim_time: true\r\n\r\n    diff_drive_controller:\r\n      type: diff_drive_controller/DiffDriveController\r\n\r\n    joint_state_broadcaster:\r\n      type: joint_state_broadcaster/JointStateBroadcaster\r\n\r\ndiff_drive_controller:\r\n  ros__parameters:\r\n    left_wheel_names: ["left_wheel_joint"]\r\n    right_wheel_names: ["right_wheel_joint"]\r\n    wheel_separation: 0.3\r\n    wheel_radius: 0.05\r\n    publish_rate: 50.0\r\n\r\n    # Velocity commands\r\n    cmd_vel_timeout: 0.5\r\n    linear.x.has_velocity_limits: true\r\n    linear.x.has_acceleration_limits: true\r\n    linear.x.has_jerk_limits: false\r\n    linear.x.max_velocity: 1.0\r\n    linear.x.min_velocity: -1.0\r\n    linear.x.max_acceleration: 2.0\r\n    linear.x.min_acceleration: -2.0\r\n    linear.x.max_jerk: 0.0\r\n    linear.x.min_jerk: 0.0\r\n\r\n    angular.z.has_velocity_limits: true\r\n    angular.z.has_acceleration_limits: true\r\n    angular.z.has_jerk_limits: false\r\n    angular.z.max_velocity: 1.0\r\n    angular.z.min_velocity: -1.0\r\n    angular.z.max_acceleration: 2.0\r\n    angular.z.min_acceleration: -2.0\r\n    angular.z.max_jerk: 0.0\r\n    angular.z.min_jerk: 0.0\n'})}),"\n",(0,t.jsx)(r.h2,{id:"exercise-2-robot-control-in-simulation",children:"Exercise 2: Robot Control in Simulation"}),"\n",(0,t.jsx)(r.h3,{id:"objective-1",children:"Objective"}),"\n",(0,t.jsx)(r.p,{children:"Implement robot control using ROS 2 messages to move the robot in the simulation environment."}),"\n",(0,t.jsxs)(r.p,{children:["Create ",(0,t.jsx)(r.code,{children:"simulation_exercises/simulation_exercises/robot_controller.py"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:'#!/usr/bin/env python3\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist, Vector3\r\nfrom nav_msgs.msg import Odometry\r\nfrom sensor_msgs.msg import LaserScan\r\nfrom tf2_ros import TransformException\r\nfrom tf2_ros.buffer import Buffer\r\nfrom tf2_ros.transform_listener import TransformListener\r\nfrom std_msgs.msg import String\r\nimport math\r\n\r\nclass RobotController(Node):\r\n    def __init__(self):\r\n        super().__init__(\'robot_controller\')\r\n        \r\n        # Create publishers\r\n        self.cmd_vel_pub = self.create_publisher(Twist, \'/cmd_vel\', 10)\r\n        \r\n        # Create subscribers\r\n        self.odom_sub = self.create_subscription(Odometry, \'/odom\', self.odom_callback, 10)\r\n        self.scan_sub = self.create_subscription(LaserScan, \'/scan\', self.scan_callback, 10)\r\n        \r\n        # TF buffer and listener for transforms\r\n        self.tf_buffer = Buffer()\r\n        self.tf_listener = TransformListener(self.tf_buffer, self)\r\n        \r\n        # Robot state\r\n        self.current_x = 0.0\r\n        self.current_y = 0.0\r\n        self.current_theta = 0.0\r\n        self.scan_ranges = []\r\n        \r\n        # Control parameters\r\n        self.linear_speed = 0.2  # m/s\r\n        self.angular_speed = 0.3  # rad/s\r\n        self.safe_distance = 0.5  # meters\r\n        self.target_x = 3.0  # Target x position\r\n        self.target_y = 2.0  # Target y position\r\n        \r\n        # Create timer for control loop\r\n        self.timer = self.create_timer(0.1, self.control_loop)  # 10 Hz\r\n        \r\n        self.get_logger().info(\'Robot Controller initialized\')\r\n\r\n    def odom_callback(self, msg):\r\n        """Update robot pose from odometry"""\r\n        self.current_x = msg.pose.pose.position.x\r\n        self.current_y = msg.pose.pose.position.y\r\n        \r\n        # Convert quaternion to yaw\r\n        q = msg.pose.pose.orientation\r\n        siny_cosp = 2 * (q.w * q.z + q.x * q.y)\r\n        cosy_cosp = 1 - 2 * (q.y * q.y + q.z * q.z)\r\n        self.current_theta = math.atan2(siny_cosp, cosy_cosp)\r\n\r\n    def scan_callback(self, msg):\r\n        """Update sensor data"""\r\n        self.scan_ranges = msg.ranges\r\n\r\n    def control_loop(self):\r\n        """Main control loop"""\r\n        # Calculate distance to target\r\n        dx = self.target_x - self.current_x\r\n        dy = self.target_y - self.current_y\r\n        distance_to_target = math.sqrt(dx*dx + dy*dy)\r\n        \r\n        # Calculate angle to target\r\n        angle_to_target = math.atan2(dy, dx)\r\n        angle_diff = angle_to_target - self.current_theta\r\n        \r\n        # Normalize angle\r\n        while angle_diff > math.pi:\r\n            angle_diff -= 2 * math.pi\r\n        while angle_diff < -math.pi:\r\n            angle_diff += 2 * math.pi\r\n        \r\n        # Check if close to target\r\n        if distance_to_target < 0.3:\r\n            self.get_logger().info(\'Reached target position!\')\r\n            self.stop_robot()\r\n            return\r\n        \r\n        # Determine if obstacle is ahead\r\n        obstacle_ahead = self.check_obstacle_ahead()\r\n        \r\n        # Create twist command\r\n        twist = Twist()\r\n        \r\n        if obstacle_ahead:\r\n            # If obstacle ahead, rotate to avoid\r\n            twist.linear.x = 0.0\r\n            twist.angular.z = self.angular_speed\r\n        elif abs(angle_diff) > 0.2:  # 0.2 radians ~ 11.5 degrees\r\n            # If not aligned with target, rotate\r\n            twist.linear.x = 0.0\r\n            twist.angular.z = self.angular_speed if angle_diff > 0 else -self.angular_speed\r\n        else:\r\n            # Move toward target\r\n            twist.linear.x = self.linear_speed\r\n            twist.angular.z = 0.0\r\n        \r\n        # Publish command\r\n        self.cmd_vel_pub.publish(twist)\r\n        \r\n        # Log current status\r\n        self.get_logger().info(\r\n            f\'Position: ({self.current_x:.2f}, {self.current_y:.2f}), \'\r\n            f\'Heading: {self.current_theta:.2f}, \'\r\n            f\'Distance to target: {distance_to_target:.2f}, \'\r\n            f\'Obstacle ahead: {obstacle_ahead}\')\r\n\r\n    def check_obstacle_ahead(self):\r\n        """Check if there is an obstacle ahead based on laser scan"""\r\n        if not self.scan_ranges:\r\n            return False\r\n            \r\n        # Check the front 30 degrees of the laser scan\r\n        front_start = len(self.scan_ranges) // 2 - 15  # -15 degrees from center\r\n        front_end = len(self.scan_ranges) // 2 + 15    # +15 degrees from center\r\n        \r\n        if front_start < 0:\r\n            front_start = 0\r\n        if front_end >= len(self.scan_ranges):\r\n            front_end = len(self.scan_ranges) - 1\r\n        \r\n        # Check if any of the front readings are within safe distance\r\n        for i in range(front_start, front_end):\r\n            if self.scan_ranges[i] < self.safe_distance and not math.isnan(self.scan_ranges[i]):\r\n                return True\r\n        \r\n        return False\r\n\r\n    def stop_robot(self):\r\n        """Stop the robot"""\r\n        twist = Twist()\r\n        twist.linear.x = 0.0\r\n        twist.angular.z = 0.0\r\n        self.cmd_vel_pub.publish(twist)\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    controller = RobotController()\r\n    \r\n    try:\r\n        rclpy.spin(controller)\r\n    except KeyboardInterrupt:\r\n        controller.get_logger().info(\'Shutting down robot controller...\')\r\n    finally:\r\n        controller.stop_robot()\r\n        controller.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,t.jsx)(r.h2,{id:"exercise-3-sensor-integration-and-processing",children:"Exercise 3: Sensor Integration and Processing"}),"\n",(0,t.jsx)(r.h3,{id:"objective-2",children:"Objective"}),"\n",(0,t.jsx)(r.p,{children:"Process data from multiple simulated sensors and implement basic sensor fusion techniques."}),"\n",(0,t.jsxs)(r.p,{children:["Create ",(0,t.jsx)(r.code,{children:"simulation_exercises/simulation_exercises/sensor_processor.py"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"#!/usr/bin/env python3\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom sensor_msgs.msg import LaserScan, Imu\r\nfrom nav_msgs.msg import Odometry\r\nfrom geometry_msgs.msg import PointStamped, Vector3\r\nfrom visualization_msgs.msg import Marker\r\nfrom tf2_ros import TransformException\r\nfrom tf2_ros.buffer import Buffer\r\nfrom tf2_ros.transform_listener import TransformListener\r\nimport math\r\nimport numpy as np\r\nfrom collections import deque\r\nimport statistics\r\n\r\nclass SensorProcessor(Node):\r\n    def __init__(self):\r\n        super().__init__('sensor_processor')\r\n        \r\n        # Create subscribers for various sensors\r\n        self.scan_sub = self.create_subscription(LaserScan, '/scan', self.scan_callback, 10)\r\n        self.imu_sub = self.create_subscription(Imu, '/imu/data', self.imu_callback, 10)\r\n        self.odom_sub = self.create_subscription(Odometry, '/odom', self.odom_callback, 10)\r\n        \r\n        # Create publishers\r\n        self.obstacle_pub = self.create_publisher(PointStamped, '/obstacle_position', 10)\r\n        self.marker_pub = self.create_publisher(Marker, '/obstacle_marker', 10)\r\n        \r\n        # TF buffer and listener\r\n        self.tf_buffer = Buffer()\r\n        self.tf_listener = TransformListener(self.tf_buffer, self)\r\n        \r\n        # Data storage\r\n        self.scan_ranges = []\r\n        self.imu_data = {'orientation': None, 'angular_velocity': None, 'linear_acceleration': None}\r\n        self.odom_data = {'position': None, 'velocity': None}\r\n        self.obstacle_history = deque(maxlen=10)  # Keep last 10 obstacle readings\r\n        \r\n        # Sensor parameters\r\n        self.safe_distance = 0.8  # meters\r\n        self.min_obstacle_size = 0.3  # meters to be considered an obstacle\r\n        \r\n        # Create timer for processing\r\n        self.timer = self.create_timer(0.5, self.process_sensor_data)  # 2 Hz\r\n        \r\n        self.get_logger().info('Sensor Processor initialized')\r\n\r\n    def scan_callback(self, msg):\r\n        \"\"\"Process laser scan data\"\"\"\r\n        self.scan_ranges = msg.ranges\r\n        self.scan_angle_min = msg.angle_min\r\n        self.scan_angle_max = msg.angle_max\r\n        self.scan_angle_increment = msg.angle_increment\r\n        self.scan_range_min = msg.range_min\r\n        self.scan_range_max = msg.range_max\r\n\r\n    def imu_callback(self, msg):\r\n        \"\"\"Process IMU data\"\"\"\r\n        self.imu_data = {\r\n            'orientation': msg.orientation,\r\n            'angular_velocity': msg.angular_velocity,\r\n            'linear_acceleration': msg.linear_acceleration\r\n        }\r\n\r\n    def odom_callback(self, msg):\r\n        \"\"\"Process odometry data\"\"\"\r\n        self.odom_data = {\r\n            'position': msg.pose.pose.position,\r\n            'velocity': msg.twist.twist.linear\r\n        }\r\n\r\n    def process_sensor_data(self):\r\n        \"\"\"Main processing function\"\"\"\r\n        if not self.scan_ranges:\r\n            self.get_logger().warn('No laser data available')\r\n            return\r\n        \r\n        # Process laser scan to detect obstacles\r\n        obstacles = self.detect_obstacles()\r\n        \r\n        # Publish obstacle data if any found\r\n        if obstacles:\r\n            # Average the obstacle positions to smooth readings\r\n            avg_x = statistics.mean([obs['x'] for obs in obstacles])\r\n            avg_y = statistics.mean([obs['y'] for obs in obstacles])\r\n            \r\n            # Create and publish obstacle marker\r\n            self.publish_obstacle_marker(avg_x, avg_y)\r\n            \r\n            # Store obstacle for history\r\n            self.obstacle_history.append({'x': avg_x, 'y': avg_y, 'timestamp': self.get_clock().now()})\r\n            \r\n            self.get_logger().info(f'Detected obstacle at ({avg_x:.2f}, {avg_y:.2f})')\r\n        else:\r\n            self.get_logger().info('No obstacles detected')\r\n        \r\n        # Process and log IMU data\r\n        if self.imu_data['linear_acceleration']:\r\n            # Calculate approximate heading change from IMU\r\n            angular_z = self.imu_data['angular_velocity'].z\r\n            self.get_logger().info(f'Angular velocity: {angular_z:.3f} rad/s')\r\n        \r\n        # Process and log odometry data\r\n        if self.odom_data['velocity']:\r\n            linear_speed = math.sqrt(\r\n                self.odom_data['velocity'].x**2 + \r\n                self.odom_data['velocity'].y**2\r\n            )\r\n            self.get_logger().info(f'Current speed: {linear_speed:.3f} m/s')\r\n\r\n    def detect_obstacles(self):\r\n        \"\"\"Detect obstacles from laser scan data\"\"\"\r\n        obstacles = []\r\n        \r\n        if not self.scan_ranges:\r\n            return obstacles\r\n        \r\n        # Group consecutive readings that represent the same obstacle\r\n        current_obstacle = []\r\n        \r\n        for i, range_val in enumerate(self.scan_ranges):\r\n            if range_val < self.safe_distance and not math.isnan(range_val):\r\n                # Calculate angle for this reading\r\n                angle = self.scan_angle_min + i * self.scan_angle_increment\r\n                \r\n                # Convert to Cartesian coordinates (relative to robot)\r\n                x = range_val * math.cos(angle)\r\n                y = range_val * math.sin(angle)\r\n                \r\n                if current_obstacle:\r\n                    # Check if this point is close to the previous one\r\n                    prev_x, prev_y = current_obstacle[-1]\r\n                    distance = math.sqrt((x - prev_x)**2 + (y - prev_y)**2)\r\n                    \r\n                    if distance < 0.2:  # Points within 20cm are part of same obstacle\r\n                        current_obstacle.append((x, y))\r\n                    else:\r\n                        # This is a new obstacle, save previous one if large enough\r\n                        if len(current_obstacle) >= 2:  # At least 2 points to be an obstacle\r\n                            center_x = sum([p[0] for p in current_obstacle]) / len(current_obstacle)\r\n                            center_y = sum([p[1] for p in current_obstacle]) / len(current_obstacle)\r\n                            obstacles.append({'x': center_x, 'y': center_y})\r\n                        \r\n                        # Start new obstacle\r\n                        current_obstacle = [(x, y)]\r\n                else:\r\n                    current_obstacle = [(x, y)]\r\n            else:\r\n                # End of obstacle, save it if large enough\r\n                if current_obstacle and len(current_obstacle) >= 2:\r\n                    center_x = sum([p[0] for p in current_obstacle]) / len(current_obstacle)\r\n                    center_y = sum([p[1] for p in current_obstacle]) / len(current_obstacle)\r\n                    obstacles.append({'x': center_x, 'y': center_y})\r\n                \r\n                current_obstacle = []\r\n        \r\n        # Don't forget the last obstacle if we were in one\r\n        if current_obstacle and len(current_obstacle) >= 2:\r\n            center_x = sum([p[0] for p in current_obstacle]) / len(current_obstacle)\r\n            center_y = sum([p[1] for p in current_obstacle]) / len(current_obstacle)\r\n            obstacles.append({'x': center_x, 'y': center_y})\r\n        \r\n        return obstacles\r\n\r\n    def publish_obstacle_marker(self, x, y):\r\n        \"\"\"Publish visualization marker for detected obstacle\"\"\"\r\n        marker = Marker()\r\n        marker.header.frame_id = 'odom'  # Use odom frame for global visualization\r\n        marker.header.stamp = self.get_clock().now().to_msg()\r\n        marker.ns = 'obstacle_detection'\r\n        marker.id = 0\r\n        marker.type = Marker.SPHERE\r\n        marker.action = Marker.ADD\r\n        \r\n        marker.pose.position.x = x\r\n        marker.pose.position.y = y\r\n        marker.pose.position.z = 0.1  # Slightly above ground\r\n        marker.pose.orientation.w = 1.0\r\n        \r\n        marker.scale.x = 0.2  # 20cm diameter sphere\r\n        marker.scale.y = 0.2\r\n        marker.scale.z = 0.2\r\n        \r\n        marker.color.a = 0.8  # Alpha\r\n        marker.color.r = 1.0  # Red\r\n        marker.color.g = 0.0\r\n        marker.color.b = 0.0\r\n        \r\n        self.marker_pub.publish(marker)\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    processor = SensorProcessor()\r\n    \r\n    try:\r\n        rclpy.spin(processor)\r\n    except KeyboardInterrupt:\r\n        processor.get_logger().info('Shutting down sensor processor...')\r\n    finally:\r\n        processor.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(r.h2,{id:"exercise-4-launch-file-integration",children:"Exercise 4: Launch File Integration"}),"\n",(0,t.jsx)(r.h3,{id:"objective-3",children:"Objective"}),"\n",(0,t.jsx)(r.p,{children:"Create launch files to run the complete simulation environment with all nodes."}),"\n",(0,t.jsxs)(r.p,{children:["Create ",(0,t.jsx)(r.code,{children:"simulation_exercises/launch/simulation_exercises.launch.py"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"from launch import LaunchDescription\r\nfrom launch.actions import IncludeLaunchDescription, ExecuteProcess, RegisterEventHandler\r\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\r\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution\r\nfrom launch_ros.actions import Node\r\nfrom launch_ros.substitutions import FindPackageShare\r\nfrom launch.event_handlers import OnProcessExit\r\nfrom ament_index_python.packages import get_package_share_directory\r\nimport os\r\n\r\ndef generate_launch_description():\r\n    # Get the package directory\r\n    pkg_share = get_package_share_directory('simulation_exercises')\r\n    \r\n    # World file path\r\n    world_file = os.path.join(pkg_share, 'worlds', 'robotics_lab.sdf')\r\n    \r\n    # URDF file path\r\n    urdf_file = os.path.join(pkg_share, 'urdf', 'differential_drive_robot.urdf')\r\n    \r\n    # Controller config file path\r\n    controller_config_file = os.path.join(pkg_share, 'config', 'diff_drive_controller.yaml')\r\n    \r\n    # Launch Gazebo with the world\r\n    gazebo = ExecuteProcess(\r\n        cmd=['gazebo', '--verbose', world_file, \r\n             '-s', 'libgazebo_ros_init.so',\r\n             '-s', 'libgazebo_ros_factory.so'],\r\n        output='screen'\r\n    )\r\n    \r\n    # Robot State Publisher\r\n    robot_state_publisher = Node(\r\n        package='robot_state_publisher',\r\n        executable='robot_state_publisher',\r\n        name='robot_state_publisher',\r\n        output='screen',\r\n        parameters=[\r\n            {'use_sim_time': True},\r\n            {'robot_description': open(urdf_file).read()}\r\n        ]\r\n    )\r\n    \r\n    # Spawn entity in Gazebo\r\n    spawn_entity = Node(\r\n        package='gazebo_ros',\r\n        executable='spawn_entity.py',\r\n        arguments=[\r\n            '-topic', 'robot_description',\r\n            '-entity', 'diff_drive_robot',\r\n            '-x', '0', '-y', '0', '-z', '0.1'\r\n        ],\r\n        output='screen'\r\n    )\r\n    \r\n    # Robot controller\r\n    robot_controller = Node(\r\n        package='simulation_exercises',\r\n        executable='robot_controller',\r\n        name='robot_controller',\r\n        parameters=[{'use_sim_time': True}],\r\n        output='screen'\r\n    )\r\n    \r\n    # Sensor processor\r\n    sensor_processor = Node(\r\n        package='simulation_exercises',\r\n        executable='sensor_processor',\r\n        name='sensor_processor',\r\n        parameters=[{'use_sim_time': True}],\r\n        output='screen'\r\n    )\r\n    \r\n    # Joint state publisher (for non-controlled joints)\r\n    joint_state_publisher = Node(\r\n        package='joint_state_publisher',\r\n        executable='joint_state_publisher',\r\n        name='joint_state_publisher',\r\n        parameters=[{'use_sim_time': True}],\r\n        output='screen'\r\n    )\r\n    \r\n    # Controller manager\r\n    controller_manager = Node(\r\n        package='controller_manager',\r\n        executable='ros2_control_node',\r\n        parameters=[controller_config_file, {'use_sim_time': True}],\r\n        output='screen'\r\n    )\r\n    \r\n    # Load and start controllers\r\n    load_joint_state_broadcaster = ExecuteProcess(\r\n        cmd=['ros2', 'control', 'load_controller', '--set-state', 'start',\r\n             'joint_state_broadcaster'],\r\n        output='screen'\r\n    )\r\n    \r\n    load_diff_drive_controller = ExecuteProcess(\r\n        cmd=['ros2', 'control', 'load_controller', '--set-state', 'start',\r\n             'diff_drive_controller'],\r\n        output='screen'\r\n    )\r\n    \r\n    return LaunchDescription([\r\n        gazebo,\r\n        robot_state_publisher,\r\n        joint_state_publisher,\r\n        spawn_entity,\r\n        controller_manager,\r\n        load_joint_state_broadcaster,\r\n        load_diff_drive_controller,\r\n        robot_controller,\r\n        sensor_processor,\r\n    ])\n"})}),"\n",(0,t.jsx)(r.h2,{id:"exercise-5-custom-gazebo-plugin",children:"Exercise 5: Custom Gazebo Plugin"}),"\n",(0,t.jsx)(r.h3,{id:"objective-4",children:"Objective"}),"\n",(0,t.jsx)(r.p,{children:"Create a custom Gazebo plugin to simulate specific robot behaviors or environmental conditions."}),"\n",(0,t.jsxs)(r.p,{children:["Create ",(0,t.jsx)(r.code,{children:"simulation_exercises/gazebo_plugins/custom_force_plugin.cpp"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-cpp",children:"#include <gazebo/gazebo.hh>\r\n#include <gazebo/physics/physics.hh>\r\n#include <gazebo/common/common.hh>\r\n#include <ignition/math/Vector3.hh>\r\n#include <rclcpp/rclcpp.hpp>\r\n#include <geometry_msgs/msg/twist.hpp>\r\n\r\nnamespace gazebo\r\n{\r\n  class CustomForcePlugin : public ModelPlugin\r\n  {\r\n    public: void Load(physics::ModelPtr _model, sdf::ElementPtr _sdf)\r\n    {\r\n      // Store the model pointer for later usage\r\n      this->model = _model;\r\n      \r\n      // Get the first link (chassis) - assuming it's the first link\r\n      this->link = _model->GetLink();\r\n      \r\n      // Listen to the update event. This event is broadcast every\r\n      // simulation iteration.\r\n      this->updateConnection = event::Events::ConnectWorldUpdateBegin(\r\n          std::bind(&CustomForcePlugin::OnUpdate, this));\r\n          \r\n      std::cout << \"CustomForcePlugin loaded for model: \" << _model->GetName() << std::endl;\r\n    }\r\n\r\n    // Called by the world update start event\r\n    public: void OnUpdate()\r\n    {\r\n      // Apply a small random force to simulate environmental disturbance\r\n      // This makes the simulation more challenging and realistic\r\n      \r\n      // Get current time to apply time-varying forces\r\n      double seconds = this->model->GetWorld()->SimTime().Double();\r\n      \r\n      // Apply a periodic force in the x-direction\r\n      double force_x = 0.1 * sin(seconds);\r\n      double force_y = 0.05 * cos(seconds * 1.5);\r\n      \r\n      // Apply the force to the link's center of mass\r\n      ignition::math::Vector3d force(force_x, force_y, 0);\r\n      this->link->AddForce(force);\r\n    }\r\n\r\n    // Pointer to the model\r\n    private: physics::ModelPtr model;\r\n    \r\n    // Pointer to the link\r\n    private: physics::LinkPtr link;\r\n    \r\n    // Event connection\r\n    private: event::ConnectionPtr updateConnection;\r\n  };\r\n\r\n  // Register this plugin with the simulator\r\n  GZ_REGISTER_MODEL_PLUGIN(CustomForcePlugin)\r\n}\n"})}),"\n",(0,t.jsx)(r.h2,{id:"exercise-6-testing-and-validation",children:"Exercise 6: Testing and Validation"}),"\n",(0,t.jsx)(r.h3,{id:"objective-5",children:"Objective"}),"\n",(0,t.jsx)(r.p,{children:"Create a simple test to validate that all components are working correctly."}),"\n",(0,t.jsxs)(r.p,{children:["Create ",(0,t.jsx)(r.code,{children:"simulation_exercises/test/simulation_test.py"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"#!/usr/bin/env python3\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist\r\nfrom nav_msgs.msg import Odometry\r\nfrom sensor_msgs.msg import LaserScan\r\nimport time\r\n\r\nclass SimulationTest(Node):\r\n    def __init__(self):\r\n        super().__init__('simulation_test')\r\n        \r\n        # Create publishers and subscribers\r\n        self.cmd_vel_pub = self.create_publisher(Twist, '/cmd_vel', 10)\r\n        self.odom_sub = self.create_subscription(Odometry, '/odom', self.odom_callback, 10)\r\n        self.scan_sub = self.create_subscription(LaserScan, '/scan', self.scan_callback, 10)\r\n        \r\n        # Test state\r\n        self.test_step = 0\r\n        self.initial_pos = None\r\n        self.scan_received = False\r\n        \r\n        # Create timer for test execution\r\n        self.timer = self.create_timer(1.0, self.run_test)\r\n        \r\n        self.get_logger().info('Simulation Test initialized')\r\n\r\n    def odom_callback(self, msg):\r\n        \"\"\"Store initial position for comparison\"\"\"\r\n        if self.initial_pos is None:\r\n            self.initial_pos = (msg.pose.pose.position.x, msg.pose.pose.position.y)\r\n\r\n    def scan_callback(self, msg):\r\n        \"\"\"Confirm scan is being received\"\"\"\r\n        self.scan_received = True\r\n\r\n    def run_test(self):\r\n        \"\"\"Run the test sequence\"\"\"\r\n        if self.test_step == 0:\r\n            self.get_logger().info('Test Step 0: Verifying sensor data...')\r\n            if self.scan_received:\r\n                self.get_logger().info('\u2713 Laser scan data is being received')\r\n            else:\r\n                self.get_logger().warn('\u2717 No laser scan data received')\r\n            \r\n            if self.initial_pos:\r\n                self.get_logger().info(f'\u2713 Initial position: {self.initial_pos}')\r\n            else:\r\n                self.get_logger().warn('\u2717 Initial position not received')\r\n            \r\n        elif self.test_step == 1:\r\n            self.get_logger().info('Test Step 1: Sending velocity command...')\r\n            twist = Twist()\r\n            twist.linear.x = 0.5  # Move forward at 0.5 m/s\r\n            self.cmd_vel_pub.publish(twist)\r\n            \r\n        elif self.test_step == 2:\r\n            self.get_logger().info('Test Step 2: Checking robot movement...')\r\n            # Stop the robot\r\n            twist = Twist()\r\n            twist.linear.x = 0.0\r\n            self.cmd_vel_pub.publish(twist)\r\n            \r\n        elif self.test_step == 3:\r\n            self.get_logger().info('Test Sequence Complete')\r\n            self.timer.cancel()\r\n            return\r\n        \r\n        self.test_step += 1\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    test_node = SimulationTest()\r\n    \r\n    try:\r\n        rclpy.spin(test_node)\r\n    except KeyboardInterrupt:\r\n        test_node.get_logger().info('Shutting down simulation test...')\r\n    finally:\r\n        test_node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(r.h2,{id:"exercise-7-package-configuration-files",children:"Exercise 7: Package Configuration Files"}),"\n",(0,t.jsx)(r.h3,{id:"update-package-files",children:"Update Package Files"}),"\n",(0,t.jsxs)(r.p,{children:["Update ",(0,t.jsx)(r.code,{children:"simulation_exercises/package.xml"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-xml",children:'<?xml version="1.0"?>\r\n<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>\r\n<package format="3">\r\n  <name>simulation_exercises</name>\r\n  <version>0.1.0</version>\r\n  <description>Simulation exercises for robotics course</description>\r\n  <maintainer email="user@example.com">User</maintainer>\r\n  <license>Apache-2.0</license>\r\n\r\n  <depend>rclpy</depend>\r\n  <depend>std_msgs</depend>\r\n  <depend>geometry_msgs</depend>\r\n  <depend>sensor_msgs</depend>\r\n  <depend>nav_msgs</depend>\r\n  <depend>tf2_ros</depend>\r\n  <depend>tf2_geometry_msgs</depend>\r\n  <depend>visualization_msgs</depend>\r\n  <depend>xacro</depend>\r\n  <depend>gazebo_ros_pkgs</depend>\r\n  <depend>gazebo_plugins</depend>\r\n  <depend>gazebo_dev</depend>\r\n  <depend>robot_state_publisher</depend>\r\n  <depend>joint_state_publisher</depend>\r\n  <depend>controller_manager</depend>\r\n  <depend>diff_drive_controller</depend>\r\n\r\n  <buildtool_depend>ament_python</buildtool_depend>\r\n\r\n  <test_depend>ament_copyright</test_depend>\r\n  <test_depend>ament_flake8</test_depend>\r\n  <test_depend>ament_pep257</test_depend>\r\n  <test_depend>python3-pytest</test_depend>\r\n\r\n  <export>\r\n    <build_type>ament_python</build_type>\r\n  </export>\r\n</package>\n'})}),"\n",(0,t.jsxs)(r.p,{children:["Update ",(0,t.jsx)(r.code,{children:"simulation_exercises/setup.py"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-python",children:"from setuptools import setup\r\nfrom glob import glob\r\nimport os\r\n\r\npackage_name = 'simulation_exercises'\r\n\r\nsetup(\r\n    name=package_name,\r\n    version='0.1.0',\r\n    packages=[package_name],\r\n    data_files=[\r\n        ('share/ament_index/resource_index/packages',\r\n            ['resource/' + package_name]),\r\n        ('share/' + package_name, ['package.xml']),\r\n        # Include URDF files\r\n        (os.path.join('share', package_name, 'urdf'), glob('urdf/*.urdf')),\r\n        # Include world files\r\n        (os.path.join('share', package_name, 'worlds'), glob('worlds/*.sdf')),\r\n        # Include config files\r\n        (os.path.join('share', package_name, 'config'), glob('config/*.yaml')),\r\n        # Include launch files\r\n        (os.path.join('share', package_name, 'launch'), glob('launch/*.py')),\r\n    ],\r\n    install_requires=['setuptools'],\r\n    zip_safe=True,\r\n    maintainer='User',\r\n    maintainer_email='user@example.com',\r\n    description='Simulation exercises for robotics course',\r\n    license='Apache-2.0',\r\n    tests_require=['pytest'],\r\n    entry_points={\r\n        'console_scripts': [\r\n            'robot_controller = simulation_exercises.robot_controller:main',\r\n            'sensor_processor = simulation_exercises.sensor_processor:main',\r\n            'simulation_test = simulation_exercises.simulation_test:main',\r\n        ],\r\n    },\r\n)\n"})}),"\n",(0,t.jsx)(r.h2,{id:"exercise-8-running-the-complete-simulation",children:"Exercise 8: Running the Complete Simulation"}),"\n",(0,t.jsx)(r.h3,{id:"steps-to-execute",children:"Steps to Execute:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"Build the package:"})}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"cd ~/ros2_ws\r\ncolcon build --packages-select simulation_exercises\r\nsource install/setup.bash\n"})}),"\n",(0,t.jsxs)(r.ol,{start:"2",children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"Run the complete simulation:"})}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"ros2 launch simulation_exercises simulation_exercises.launch.py\n"})}),"\n",(0,t.jsxs)(r.ol,{start:"3",children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"In a separate terminal, visualize the simulation:"})}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# To visualize the robot model\r\nros2 run rviz2 rviz2\r\n\r\n# To check topics\r\nros2 topic list\r\n\r\n# To see messages on specific topics\r\nros2 topic echo /odom\r\nros2 topic echo /scan\n"})}),"\n",(0,t.jsxs)(r.ol,{start:"4",children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"Run the test node to verify everything works:"})}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"ros2 run simulation_exercises simulation_test\n"})}),"\n",(0,t.jsxs)(r.ol,{start:"5",children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"Try sending manual commands to the robot:"})}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Send velocity commands\r\nros2 topic pub /cmd_vel geometry_msgs/msg/Twist '{linear: {x: 0.2}, angular: {z: 0.1}}'\n"})}),"\n",(0,t.jsx)(r.h2,{id:"troubleshooting-common-issues",children:"Troubleshooting Common Issues"}),"\n",(0,t.jsx)(r.h3,{id:"1-robot-not-moving-in-simulation",children:"1. Robot not moving in simulation"}),"\n",(0,t.jsx)(r.p,{children:"If the robot doesn't respond to velocity commands:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Check if the diff_drive_controller is running\r\nros2 lifecycle list diff_drive_controller\r\n\r\n# Check if robot_description is available\r\nros2 param list | grep robot_description\r\n\r\n# Check for errors in the diff_drive_controller\r\nros2 lifecycle set diff_drive_controller configure\r\nros2 lifecycle set diff_drive_controller activate\n"})}),"\n",(0,t.jsx)(r.h3,{id:"2-sensor-data-not-available",children:"2. Sensor data not available"}),"\n",(0,t.jsx)(r.p,{children:"If sensor topics are not being published:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Check if plugins are loaded\r\ngz model -m diff_drive_robot --info\r\n\r\n# Check for Gazebo model plugins\r\nros2 run gazebo_ros spawn_entity.py -h\n"})}),"\n",(0,t.jsx)(r.h3,{id:"3-tf-tree-issues",children:"3. TF tree issues"}),"\n",(0,t.jsx)(r.p,{children:"If transforms aren't available:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# View the TF tree\r\nros2 run tf2_tools view_frames\r\n\r\n# Echo specific transforms\r\nros2 run tf2_ros tf2_echo odom base_link\n"})}),"\n",(0,t.jsx)(r.h2,{id:"performance-optimization-tips",children:"Performance Optimization Tips"}),"\n",(0,t.jsx)(r.h3,{id:"1-physics-optimization",children:"1. Physics Optimization"}),"\n",(0,t.jsx)(r.p,{children:"For better performance, consider reducing physics accuracy:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-xml",children:'<physics name="ode" default="0" type="ode">\r\n  <max_step_size>0.01</max_step_size>  \x3c!-- Increase for performance --\x3e\r\n  <real_time_factor>1.0</real_time_factor>\r\n  <ode>\r\n    <solver>\r\n      <iters>20</iters>  \x3c!-- Reduce for performance --\x3e\r\n      <sor>1.3</sor>\r\n    </solver>\r\n  </ode>\r\n</physics>\n'})}),"\n",(0,t.jsx)(r.h3,{id:"2-sensor-rate-optimization",children:"2. Sensor Rate Optimization"}),"\n",(0,t.jsx)(r.p,{children:"Adjust sensor update rates for better performance:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-xml",children:'<sensor name="camera" type="camera">\r\n  <update_rate>15</update_rate>  \x3c!-- Reduce for performance --\x3e\r\n</sensor>\n'})}),"\n",(0,t.jsx)(r.h2,{id:"summary",children:"Summary"}),"\n",(0,t.jsx)(r.p,{children:"This practical exercise module covered:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Complete simulation environment setup"}),": Creating worlds, robots, and integration with ROS 2"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Robot control implementation"}),": Moving robots using ROS 2 messages and control algorithms"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Sensor integration and processing"}),": Working with multiple sensor types and implementing sensor fusion"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Launch file integration"}),": Combining all components into a single launch file"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Custom Gazebo plugins"}),": Extending simulation capabilities with custom plugins"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Testing and validation"}),": Verifying that all components work together"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Troubleshooting and optimization"}),": Common issues and performance tips"]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"These exercises provide hands-on experience with the practical aspects of robot simulation, which is essential for real-world robotics development. You have now built a complete simulation environment with a mobile robot that can navigate and process sensor data in a virtual world."})]})}function m(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>a});var i=n(6540);const t={},s=i.createContext(t);function o(e){const r=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(s.Provider,{value:r},e.children)}}}]);