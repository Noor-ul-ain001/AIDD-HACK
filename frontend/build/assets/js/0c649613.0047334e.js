"use strict";(globalThis.webpackChunkphysical_ai_platform_frontend=globalThis.webpackChunkphysical_ai_platform_frontend||[]).push([[6939],{8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>a});var i=r(6540);const s={},l=i.createContext(s);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(l.Provider,{value:n},e.children)}},9694:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>_,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module-1/week-3-services-actions","title":"Week 3: Services and Actions","description":"Overview","source":"@site/docs/module-1/week-3-services-actions.md","sourceDirName":"module-1","slug":"/module-1/week-3-services-actions","permalink":"/docs/module-1/week-3-services-actions","draft":false,"unlisted":false,"editUrl":"https://github.com/noor-ana/physical-ai-platform/tree/main/docs/module-1/week-3-services-actions.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"difficulty":"beginner"}}');var s=r(4848),l=r(8453);const t={sidebar_position:3,difficulty:"beginner"},a="Week 3: Services and Actions",o={},c=[{value:"Overview",id:"overview",level:2},{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Services in ROS 2",id:"services-in-ros-2",level:2},{value:"Service Definition",id:"service-definition",level:3},{value:"Service Server",id:"service-server",level:3},{value:"Service Client",id:"service-client",level:3},{value:"Actions in ROS 2",id:"actions-in-ros-2",level:2},{value:"Action Definition",id:"action-definition",level:3},{value:"Action Server",id:"action-server",level:3},{value:"Action Client",id:"action-client",level:3},{value:"Choosing the Right Communication Pattern",id:"choosing-the-right-communication-pattern",level:2},{value:"When to Use Each Pattern",id:"when-to-use-each-pattern",level:3},{value:"Practical Example: Robot Arm Controller",id:"practical-example-robot-arm-controller",level:2},{value:"Service and Action Commands",id:"service-and-action-commands",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Summary",id:"summary",level:2},{value:"Exercises",id:"exercises",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"week-3-services-and-actions",children:"Week 3: Services and Actions"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"This week focuses on two more communication patterns in ROS 2: Services and Actions. While topics provide asynchronous, decoupled communication, services and actions provide synchronous and goal-oriented communication respectively."}),"\n",(0,s.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,s.jsx)(n.p,{children:"By the end of this week, you will:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Understand the difference between topics, services, and actions"}),"\n",(0,s.jsx)(n.li,{children:"Implement ROS 2 services (request/response)"}),"\n",(0,s.jsx)(n.li,{children:"Implement ROS 2 actions (goal/feedback/result)"}),"\n",(0,s.jsx)(n.li,{children:"Choose the appropriate communication pattern for different use cases"}),"\n",(0,s.jsx)(n.li,{children:"Debug service and action communication"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"services-in-ros-2",children:"Services in ROS 2"}),"\n",(0,s.jsx)(n.p,{children:"Services implement a request/reply communication pattern. A service client sends a request to a service server, which processes the request and returns a response. This is synchronous communication."}),"\n",(0,s.jsx)(n.h3,{id:"service-definition",children:"Service Definition"}),"\n",(0,s.jsxs)(n.p,{children:["Service definitions are stored in ",(0,s.jsx)(n.code,{children:".srv"})," files with two parts: the request and the response, separated by three dashes (",(0,s.jsx)(n.code,{children:"---"}),")."]}),"\n",(0,s.jsxs)(n.p,{children:["Example: ",(0,s.jsx)(n.code,{children:"AddTwoInts.srv"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"int64 a\r\nint64 b\r\n---\r\nint64 sum\n"})}),"\n",(0,s.jsx)(n.h3,{id:"service-server",children:"Service Server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\nclass MinimalService(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_service')\r\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\r\n\r\n    def add_two_ints_callback(self, request, response):\r\n        response.sum = request.a + request.b\r\n        self.get_logger().info(f'Returning {request.a} + {request.b} = {response.sum}')\r\n        return response\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    minimal_service = MinimalService()\r\n    rclpy.spin(minimal_service)\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"service-client",children:"Service Client"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\n\r\nclass MinimalClient(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_client')\r\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\r\n        while not self.cli.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('Service not available, waiting again...')\r\n        self.req = AddTwoInts.Request()\r\n\r\n    def send_request(self, a, b):\r\n        self.req.a = a\r\n        self.req.b = b\r\n        self.future = self.cli.call_async(self.req)\r\n        rclpy.spin_until_future_complete(self, self.future)\r\n        return self.future.result()\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    minimal_client = MinimalClient()\r\n    response = minimal_client.send_request(41, 1)\r\n    minimal_client.get_logger().info(f'Result of add_two_ints: {response.sum}')\r\n    minimal_client.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"actions-in-ros-2",children:"Actions in ROS 2"}),"\n",(0,s.jsx)(n.p,{children:"Actions are used for long-running tasks that provide feedback and can be canceled. They follow a goal/feedback/result pattern and are ideal for tasks like navigation or manipulation."}),"\n",(0,s.jsx)(n.h3,{id:"action-definition",children:"Action Definition"}),"\n",(0,s.jsxs)(n.p,{children:["Action definitions are stored in ",(0,s.jsx)(n.code,{children:".action"})," files with three parts: Goal, Result, and Feedback."]}),"\n",(0,s.jsxs)(n.p,{children:["Example: ",(0,s.jsx)(n.code,{children:"Fibonacci.action"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"int32 order\r\n---\r\nint32[] sequence\r\n---\r\nint32[] sequence\n"})}),"\n",(0,s.jsx)(n.h3,{id:"action-server",children:"Action Server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.action import ActionServer, CancelResponse, GoalResponse\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci\r\n\r\nclass MinimalActionServer(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_action_server')\r\n        self._action_server = ActionServer(\r\n            self,\r\n            Fibonacci,\r\n            'fibonacci',\r\n            execute_callback=self.execute_callback,\r\n            goal_callback=self.goal_callback,\r\n            cancel_callback=self.cancel_callback)\r\n\r\n    def goal_callback(self, goal_request):\r\n        self.get_logger().info('Received goal request')\r\n        return GoalResponse.ACCEPT\r\n\r\n    def cancel_callback(self, goal_handle):\r\n        self.get_logger().info('Received cancel request')\r\n        return CancelResponse.ACCEPT\r\n\r\n    async def execute_callback(self, goal_handle):\r\n        self.get_logger().info('Executing goal...')\r\n        \r\n        feedback_msg = Fibonacci.Feedback()\r\n        feedback_msg.sequence = [0, 1]\r\n        \r\n        for i in range(1, goal_handle.request.order):\r\n            if goal_handle.is_cancel_requested:\r\n                goal_handle.canceled()\r\n                self.get_logger().info('Goal was canceled')\r\n                return Fibonacci.Result()\r\n            \r\n            feedback_msg.sequence.append(feedback_msg.sequence[i] + feedback_msg.sequence[i-1])\r\n            self.get_logger().info(f'Publishing feedback: {feedback_msg.sequence}')\r\n            goal_handle.publish_feedback(feedback_msg)\r\n        \r\n        goal_handle.succeed()\r\n        result = Fibonacci.Result()\r\n        result.sequence = feedback_msg.sequence\r\n        self.get_logger().info(f'Returning result: {result.sequence}')\r\n        \r\n        return result\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    action_server = MinimalActionServer()\r\n    rclpy.spin(action_server)\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"action-client",children:"Action Client"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.action import ActionClient\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.action import Fibonacci\r\n\r\nclass MinimalActionClient(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_action_client')\r\n        self._action_client = ActionClient(self, Fibonacci, 'fibonacci')\r\n\r\n    def send_goal(self, order):\r\n        goal_msg = Fibonacci.Goal()\r\n        goal_msg.order = order\r\n        \r\n        self._action_client.wait_for_server()\r\n        self._send_goal_future = self._action_client.send_goal_async(\r\n            goal_msg,\r\n            feedback_callback=self.feedback_callback)\r\n        \r\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\r\n\r\n    def goal_response_callback(self, future):\r\n        goal_handle = future.result()\r\n        if not goal_handle.accepted:\r\n            self.get_logger().info('Goal rejected')\r\n            return\r\n\r\n        self.get_logger().info('Goal accepted')\r\n        self._get_result_future = goal_handle.get_result_async()\r\n        self._get_result_future.add_done_callback(self.get_result_callback)\r\n\r\n    def feedback_callback(self, feedback_msg):\r\n        feedback = feedback_msg.feedback\r\n        self.get_logger().info(f'Received feedback: {feedback.sequence}')\r\n\r\n    def get_result_callback(self, future):\r\n        result = future.result().result\r\n        self.get_logger().info(f'Result: {result.sequence}')\r\n        rclpy.shutdown()\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    action_client = MinimalActionClient()\r\n    action_client.send_goal(10)\r\n    rclpy.spin(action_client)\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"choosing-the-right-communication-pattern",children:"Choosing the Right Communication Pattern"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Pattern"}),(0,s.jsx)(n.th,{children:"Use Case"}),(0,s.jsx)(n.th,{children:"Characteristics"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Topics"}),(0,s.jsx)(n.td,{children:"Continuous data streams"}),(0,s.jsx)(n.td,{children:"Asynchronous, decoupled"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Services"}),(0,s.jsx)(n.td,{children:"Simple request/response"}),(0,s.jsx)(n.td,{children:"Synchronous, blocking"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Actions"}),(0,s.jsx)(n.td,{children:"Long-running tasks"}),(0,s.jsx)(n.td,{children:"Asynchronous, with feedback and cancellation"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"when-to-use-each-pattern",children:"When to Use Each Pattern"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Topics"}),": Sensor data streams, state publishing, status updates"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Services"}),": Simple computations, configuration changes, one-time requests"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Actions"}),": Navigation goals, manipulation tasks, calibration sequences"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"practical-example-robot-arm-controller",children:"Practical Example: Robot Arm Controller"}),"\n",(0,s.jsx)(n.p,{children:"Let's implement a comprehensive example using all three communication patterns:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Robot Arm Controller\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom rclpy.qos import QoSProfile, QoSHistoryPolicy, QoSReliabilityPolicy\r\nfrom std_msgs.msg import Float32MultiArray\r\nfrom example_interfaces.srv import SetBool\r\nfrom example_interfaces.action import MultiGoal\r\nfrom rclpy.action import ActionServer, GoalResponse\r\n\r\nclass RobotArmController(Node):\r\n    def __init__(self):\r\n        super().__init__('robot_arm_controller')\r\n        \r\n        # Topic: Joint angles feedback\r\n        qos_profile = QoSProfile(\r\n            history=QoSHistoryPolicy.KEEP_LAST,\r\n            depth=10,\r\n            reliability=QoSReliabilityPolicy.RELIABLE\r\n        )\r\n        self.joint_publisher = self.create_publisher(Float32MultiArray, 'joint_angles', qos_profile)\r\n        \r\n        # Service: Check if arm is ready\r\n        self.ready_service = self.create_service(SetBool, 'arm_ready', self.arm_ready_callback)\r\n        \r\n        # Action: Move to position\r\n        self.move_action_server = ActionServer(\r\n            self,\r\n            MultiGoal,\r\n            'move_arm',\r\n            self.execute_move_callback\r\n        )\r\n        \r\n        # Simulate joint angles\r\n        self.joint_angles = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0]  # 6 joints\r\n        self.timer = self.create_timer(0.1, self.publish_joint_angles)\r\n    \r\n    def publish_joint_angles(self):\r\n        msg = Float32MultiArray()\r\n        msg.data = self.joint_angles\r\n        self.joint_publisher.publish(msg)\r\n    \r\n    def arm_ready_callback(self, request, response):\r\n        # Check if all joints are within safe limits\r\n        is_safe = all(-3.14 <= angle <= 3.14 for angle in self.joint_angles)\r\n        response.success = is_safe\r\n        response.message = f'Arm is {\"ready\" if is_safe else \"not ready\"}'\r\n        return response\r\n    \r\n    def execute_move_callback(self, goal_handle):\r\n        self.get_logger().info(f'Executing move to: {goal_handle.request.goals}')\r\n        # Simulate movement\r\n        self.joint_angles = goal_handle.request.goals\r\n        goal_handle.succeed()\r\n        result = MultiGoal.Result()\r\n        result.result = True\r\n        return result\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    controller = RobotArmController()\r\n    rclpy.spin(controller)\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"service-and-action-commands",children:"Service and Action Commands"}),"\n",(0,s.jsx)(n.p,{children:"Useful command-line tools for working with services and actions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Services\r\nros2 service list                    # List all services\r\nros2 service info /service_name      # Get information about a service\r\nros2 service type /service_name      # Get service type\r\nros2 service call /service_name service_type "request_data"\r\n\r\n# Actions\r\nros2 action list                     # List all actions\r\nros2 action info /action_name        # Get information about an action\r\nros2 action send_goal /action_name action_type "goal_data"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Use services for simple, quick operations that have a clear result"}),"\n",(0,s.jsx)(n.li,{children:"Use actions for long-running operations that may need cancellation"}),"\n",(0,s.jsx)(n.li,{children:"Use topics for continuous data streams"}),"\n",(0,s.jsx)(n.li,{children:"Always handle service and action client errors appropriately"}),"\n",(0,s.jsx)(n.li,{children:"Implement proper timeouts for service calls"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"This week covered services and actions, two important communication patterns in ROS 2. Services provide synchronous request/response communication, while actions are designed for long-running tasks with feedback and cancellation. You learned how to implement and use both patterns, and when to apply each one."}),"\n",(0,s.jsx)(n.p,{children:"Next week, we'll explore TF (Transforms) and URDF (Unified Robot Description Format), which are essential for spatial relationships and robot modeling."}),"\n",(0,s.jsx)(n.h2,{id:"exercises",children:"Exercises"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create a service that calculates the Euclidean distance between two points"}),"\n",(0,s.jsx)(n.li,{children:"Implement an action that performs a 10-second counting operation with feedback"}),"\n",(0,s.jsx)(n.li,{children:"Build a robot simulator node that publishes transform data"}),"\n",(0,s.jsx)(n.li,{children:"Debug a provided service implementation with incorrect response handling"}),"\n"]})]})}function _(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);